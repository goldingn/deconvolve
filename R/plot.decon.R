#' Sets default plotting for decon object
#'
#' This function sets up the default plotting method
#' for outputs from deconvolve function
#'
#' @param decon decon object as generated by deconvolve
#' @param plot_type specify if want the basic graph with 'raw', else defaults to the mixture graph
#' @param ... other options passed to plot
#' @return plot
#' @import pryr
#' @method plot decon
#' @importFrom graphics legend lines par plot
#'
#' @export

plot.decon <- function (decon, plot_type = NULL, ...) {

  x <- seq(decon$bounds[1], decon$bounds[2], length.out = nrow(decon$data))
  data <- decon$data
  fit <- decon$minpack.lm_object

  if (!is.null(plot_type) && plot_type == 'raw') {
    par(mfrow=c(1,2))
    plot(data$temp_K, data$mass_T, xlab = 'Temperature (K)', ylab = 'Mass Remaining (mg)')
    plot(data$temp_K, data$deriv, xlab = 'Temperature (K)', ylab = 'DTG (dm/dT) (K-1)')
  }

  else {
    par(xpd = T, mar = par()$mar + c(0,0,0,2))
    plot(data$temp_K, data$deriv, xlab = 'Temperature (K)', ylab = 'DTG (dm/dT) (K-1)')

    y1 <- fs_mixture_wrap(x,
                          single_param(fit, 'h', '1'), single_param(fit, 'h', '2'), single_param(fit, 'h', '3'),
                          single_param(fit, 's', '1'), single_param(fit, 's', '2'), single_param(fit, 's', '3'),
                          single_param(fit, 'p', '1'), single_param(fit, 'p', '2'), single_param(fit, 'p', '3'),
                          single_param(fit, 'w', '1'), single_param(fit, 'w', '2'), single_param(fit, 'w', '3'))
    lines(x, y1, col = 'red')

    y2 <- fs_function(x,
                      single_param(fit, 'h', '1'), single_param(fit, 's', '1'),
                      single_param(fit, 'p', '1'), single_param(fit, 'w', '1'))
    lines(x, y2, col = 'blue')

    y3 <- fs_function(x,
                      single_param(fit, 'h', '2'), single_param(fit, 's', '2'),
                      single_param(fit, 'p', '2'), single_param(fit, 'w', '2'))
    lines(x, y3, col = 'green')

    y4 <- fs_function(x,
                      single_param(fit, 'h', '3'), single_param(fit, 's', '3'),
                      single_param(fit, 'p', '3'), single_param(fit, 'w', '3'))
    lines(x, y4, col = 'orange')

    legend(decon$bounds[2]+50, max(data$deriv), legend = c('Total DTG', 'P-HC', 'P-CL', 'P-LG'),
           col = c('red', 'blue', 'green', 'orange'), lty = 1, cex=0.8)
  }

}

